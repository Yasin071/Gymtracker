<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Gym Tracker</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000;
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .screen-manager {
            flex: 1;
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            background-color: #111;
        }
        
        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            padding: 0;
        }
        
        .screen.active {
            display: flex;
        }
        
        .header {
            background-color: #333;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            border-bottom: 1px solid #444;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .barbell-layout {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid #444;
        }
        
        .total-weight {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 15px;
            background-color: #333;
            color: white;
            border-bottom: 1px solid #444;
        }
        
        .barbell-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .barbell-container {
            display: flex;
            width: 100%;
            max-width: 350px; /* Wider to accommodate side plates */
            height: 200px; /* Taller for vertical stacking */
            position: relative;
        }
        
        .plate-column {
            width: 80px;
            display: flex;
            flex-direction: column-reverse; /* Stack from bottom up */
            align-items: center;
            gap: 3px;
            padding-bottom: 10px;
        }
        
        .left-plates-column {
            align-items: flex-end;
            padding-right: 5px;
        }
        
        .right-plates-column {
            align-items: flex-start;
            padding-left: 5px;
        }
        
        .barbell-sleeve {
            width: 60px;
            height: 80px;
            background-color: #333;
            align-self: center;
            z-index: 2;
            border-radius: 3px;
        }
        
        .plate {
            color: white;
            padding: 5px;
            border-radius: 4px;
            text-align: center;
            min-width: 50px;
            font-size: 0.8rem;
            font-weight: bold;
            margin: 2px 0;
        }
        
        .sets-label {
            padding: 10px;
            text-align: center;
            font-size: 1rem;
            white-space: pre-line;
            border-top: 1px solid #444;
            max-height: 20vh;
            overflow-y: auto;
            background-color: #111;
        }
        
        .controls {
            padding: 10px;
            background-color: #222;
            border-top: 1px solid #444;
        }
        
        button {
            color: white;
            border: none;
            padding: 12px;
            margin: 5px 0;
            text-align: center;
            text-decoration: none;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
            width: 100%;
            font-weight: bold;
        }
        
        button:active {
            opacity: 0.8;
        }
        
        .button-row {
            display: flex;
            gap: 10px;
        }
        
        .button-row button {
            flex: 1;
        }
        
        .plate-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #333;
            color: white;
        }
        
        .timer {
            text-align: center;
            font-size: 1.2rem;
            padding: 10px;
            background-color: #333;
            color: white;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #444;
        }
        
        /* Color-coded weight plates */
        button[data-weight="5"], .plate[data-weight="5"] { 
            background-color: #FF9800; /* Orange */
            border: 1px solid #e68a00;
        }
        button[data-weight="10"], .plate[data-weight="10"] { 
            background-color: #2196F3; /* Blue */
            border: 1px solid #1a81d6;
        }
        button[data-weight="15"], .plate[data-weight="15"] { 
            background-color: #9C27B0; /* Purple */
            border: 1px solid #822099;
        }
        button[data-weight="20"], .plate[data-weight="20"] { 
            background-color: #F44336; /* Red */
            border: 1px solid #d32f2f;
        }
        
        #set-button {
            background-color: #4CAF50;
            border: 1px solid #3e8e41;
        }
        
        #reset-weight-button {
            background-color: #f44336;
            border: 1px solid #d32f2f;
        }
        
        #delete-last-button {
            background-color: #FF9800;
            border: 1px solid #e68a00;
        }
    </style>
</head>
<body>
    <div class="screen-manager">
        <!-- Weight Screen -->
        <div class="screen weight-screen active" id="weight-screen">
            <div class="header">Gym Tracker</div>
            <div class="main-content">
                <div class="barbell-layout">
                    <div class="total-weight" id="total-weight-label">Total: 20 kg</div>
                    <div class="barbell-area">
                        <div class="barbell-container">
                            <div class="plate-column left-plates-column" id="left-plates-column"></div>
                            <div class="barbell-sleeve"></div>
                            <div class="plate-column right-plates-column" id="right-plates-column"></div>
                        </div>
                    </div>
                    <div class="sets-label" id="sets-label">No sets yet</div>
                </div>
                <div class="controls">
                    <select id="exercise-select">
                        <option value="squat">Squat</option>
                        <option value="bench">Bench Press</option>
                        <option value="deadlift">Deadlift</option>
                        <option value="ohp">Overhead Press</option>
                        <option value="custom">Custom</option>
                    </select>
                    <div class="button-row">
                        <button id="set-button">üí™ Save Set</button>
                        <button id="reset-weight-button">üîÑ Reset Weight</button>
                    </div>
                    <div class="button-row">
                        <button id="delete-last-button">‚ùå Delete Last Set</button>
                    </div>
                    <div class="timer" id="rest-timer">Rest: 0:00</div>
                    <div class="plate-buttons">
                        <button class="plate-button" data-weight="5">5 kg</button>
                        <button class="plate-button" data-weight="10">10 kg</button>
                        <button class="plate-button" data-weight="15">15 kg</button>
                        <button class="plate-button" data-weight="20">20 kg</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App state
        const state = {
            totalWeight: 20, // Barbell included
            currentExercise: "squat",
            sets: JSON.parse(localStorage.getItem('gym-sets')) || [],
            restTimer: null,
            restSeconds: 0,
            currentPlates: [] // Track added plates
        };

        // DOM elements
        const totalWeightLabel = document.getElementById('total-weight-label');
        const setsLabel = document.getElementById('sets-label');
        const leftPlatesColumn = document.getElementById('left-plates-column');
        const rightPlatesColumn = document.getElementById('right-plates-column');
        const setButton = document.getElementById('set-button');
        const resetWeightButton = document.getElementById('reset-weight-button');
        const deleteLastButton = document.getElementById('delete-last-button');
        const plateButtons = document.querySelectorAll('.plate-button');
        const exerciseSelect = document.getElementById('exercise-select');
        const restTimerDisplay = document.getElementById('rest-timer');

        // Initialize
        updateTotalWeight();
        updateSetsLabel();
        startRestTimer();

        // Add plates to barbell
        function addPlate(weight) {
            state.currentPlates.push(weight);
            renderPlates();
            state.totalWeight += weight * 2;
            updateTotalWeight();
        }

        // Remove last added plate
        function removeLastPlate() {
            if (state.currentPlates.length > 0) {
                const lastWeight = state.currentPlates.pop();
                renderPlates();
                state.totalWeight -= lastWeight * 2;
                updateTotalWeight();
            }
        }

        // Render plates in separate columns
        function renderPlates() {
            // Clear existing plates
            leftPlatesColumn.innerHTML = '';
            rightPlatesColumn.innerHTML = '';
            
            // Render plates in columns (automatically stacks vertically)
            state.currentPlates.forEach(weight => {
                const leftPlate = document.createElement('div');
                leftPlate.className = 'plate';
                leftPlate.textContent = `${weight} kg`;
                leftPlate.dataset.weight = weight;
                leftPlatesColumn.appendChild(leftPlate);
                
                const rightPlate = document.createElement('div');
                rightPlate.className = 'plate';
                rightPlate.textContent = `${weight} kg`;
                rightPlate.dataset.weight = weight;
                rightPlatesColumn.appendChild(rightPlate);
            });
        }

        // Update total weight display
        function updateTotalWeight() {
            totalWeightLabel.textContent = `Total: ${state.totalWeight} kg`;
        }

        // Reset only weights
        function resetWeight() {
            state.currentPlates = [];
            state.totalWeight = 20;
            renderPlates();
            updateTotalWeight();
        }

        // Save a completed set
        function saveSet() {
            const reps = prompt("How many reps?", "5");
            if (reps === null) return; // User cancelled

            const newSet = {
                exercise: state.currentExercise,
                weight: state.totalWeight,
                reps: parseInt(reps) || 0,
                date: new Date().toISOString()
            };

            state.sets.push(newSet);
            localStorage.setItem('gym-sets', JSON.stringify(state.sets));
            updateSetsLabel();
            resetRestTimer();
        }

        // Delete last set
        function deleteLastSet() {
            if (state.sets.length > 0) {
                state.sets.pop();
                localStorage.setItem('gym-sets', JSON.stringify(state.sets));
                updateSetsLabel();
            } else {
                alert("No sets to delete!");
            }
        }

        // Update sets label
        function updateSetsLabel() {
            const exerciseSets = state.sets
                .filter(set => set.exercise === state.currentExercise)
                .slice(-5); // Show last 5 sets
            
            if (exerciseSets.length > 0) {
                let setsText = `${state.currentExercise.toUpperCase()}:\n`;
                exerciseSets.forEach((set, i) => {
                    setsText += `${set.weight}kg √ó ${set.reps}\n`;
                });
                setsLabel.textContent = setsText;
            } else {
                setsLabel.textContent = "No sets yet";
            }
        }

        // Rest timer functions
        function startRestTimer() {
            state.restTimer = setInterval(() => {
                state.restSeconds++;
                const mins = Math.floor(state.restSeconds / 60);
                const secs = state.restSeconds % 60;
                restTimerDisplay.textContent = `Rest: ${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }, 1000);
        }

        function resetRestTimer() {
            state.restSeconds = 0;
            restTimerDisplay.textContent = "Rest: 0:00";
        }

        // Event listeners
        plateButtons.forEach(button => {
            button.addEventListener('click', () => {
                const weight = parseFloat(button.dataset.weight);
                addPlate(weight);
            });
        });

        setButton.addEventListener('click', saveSet);
        resetWeightButton.addEventListener('click', resetWeight);
        deleteLastButton.addEventListener('click', deleteLastSet);
        
        // Double-tap plate to remove it
        plateButtons.forEach(button => {
            button.addEventListener('dblclick', () => {
                const weight = parseFloat(button.dataset.weight);
                const index = state.currentPlates.lastIndexOf(weight);
                if (index > -1) {
                    state.currentPlates.splice(index, 1);
                    renderPlates();
                    state.totalWeight -= weight * 2;
                    updateTotalWeight();
                }
            });
        });
        
        exerciseSelect.addEventListener('change', (e) => {
            // Reset weight when changing exercise
            if (state.currentExercise !== e.target.value) {
                resetWeight();
            }
            state.currentExercise = e.target.value;
            updateSetsLabel();
        });

        // Service Worker for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
