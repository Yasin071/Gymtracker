<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Gym Tracker</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #000;
            color: white;
            height: 100vh;
            height: calc(100vh - env(safe-area-inset-bottom));
            display: flex;
            flex-direction: column;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .screen-manager {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            background-color: #111;
            overflow: hidden;
            position: relative;
        }
        
        /* Header with home button */
        .header {
            background-color: #333;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .home-button {
            position: absolute;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }
        
        /* Home Screen */
        .home-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
            padding: 20px;
        }
        
        .equipment-button {
            width: 150px;
            height: 150px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #333;
            border: 2px solid #444;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        /* Barbell Screen */
        .barbell-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .total-weight {
            text-align: center;
            font-size: 1.4rem;
            font-weight: bold;
            padding: 10px;
            background-color: #333;
            color: white;
        }
        
        .barbell-visual-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 0;
            padding: 10px;
        }
        
        .barbell-visual {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 150px;
            width: 100%;
            max-width: 300px;
            position: relative;
        }
        
        .plate-column {
            width: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            height: 100%;
            position: absolute;
            bottom: 0;
        }
        
        .left-plates {
            left: calc(50% - 80px);
        }
        
        .right-plates {
            left: calc(50% + 20px);
        }
        
        .barbell-sleeve {
            width: 50px;
            height: 60px;
            background-color: #333;
            position: absolute;
            left: calc(50% - 25px);
            bottom: 0;
            z-index: 2;
            border-radius: 3px;
        }
        
        .plate {
            color: white;
            padding: 4px;
            border-radius: 4px;
            text-align: center;
            min-width: 45px;
            font-size: 0.75rem;
            font-weight: bold;
            margin: 2px 0;
            position: relative;
        }
        
        .sets-display {
            padding: 8px;
            text-align: center;
            font-size: 0.9rem;
            white-space: pre-line;
            max-height: 80px;
            overflow-y: auto;
            background-color: #111;
        }
        
        .controls {
            padding: 10px;
            background-color: #222;
        }
        
        select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #333;
            color: white;
            font-size: 0.9rem;
        }
        
        .button-row {
            display: flex;
            gap: 8px;
            margin: 5px 0;
        }
        
        button {
            color: white;
            border: none;
            padding: 10px;
            text-align: center;
            font-size: 0.9rem;
            border-radius: 5px;
            flex: 1;
            font-weight: bold;
        }
        
        .timer {
            text-align: center;
            font-size: 1rem;
            padding: 8px;
            background-color: #333;
            color: white;
            border-radius: 5px;
            margin: 5px 0;
        }
        
        .plate-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        /* Color coding */
        button[data-weight="5"], .plate[data-weight="5"] { 
            background-color: #FF9800;
            border: 1px solid #e68a00;
        }
        button[data-weight="10"], .plate[data-weight="10"] { 
            background-color: #2196F3;
            border: 1px solid #1a81d6;
        }
        button[data-weight="15"], .plate[data-weight="15"] { 
            background-color: #9C27B0;
            border: 1px solid #822099;
        }
        button[data-weight="20"], .plate[data-weight="20"] { 
            background-color: #F44336;
            border: 1px solid #d32f2f;
        }
        
        #set-button { background-color: #4CAF50; border: 1px solid #3e8e41; }
        #reset-weight-button { background-color: #f44336; border: 1px solid #d32f2f; }
        #delete-last-button { background-color: #FF9800; border: 1px solid #e68a00; }
        
        /* Screen management */
        .screen {
            display: none;
            flex: 1;
            flex-direction: column;
            width: 100%;
        }
        
        .screen.active {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="screen-manager">
        <!-- Home Screen -->
        <div class="screen home-screen active" id="home-screen">
            <div class="header">
                Gym Tracker
                <button class="home-button" style="visibility: hidden;">Home</button>
            </div>
            <div class="equipment-buttons">
                <div class="equipment-button" id="barbell-button">
                    Barbell
                </div>
                <div class="equipment-button" id="dumbbell-button">
                    Dumbbell
                </div>
            </div>
        </div>
        
        <!-- Barbell Screen -->
        <div class="screen" id="barbell-screen">
            <div class="header">
                Barbell Tracker
                <button class="home-button">Home</button>
            </div>
            <div class="barbell-section">
                <div class="total-weight" id="total-weight-label">Total: 20 kg</div>
                <div class="barbell-visual-container">
                    <div class="barbell-visual">
                        <div class="plate-column left-plates" id="left-plates"></div>
                        <div class="barbell-sleeve"></div>
                        <div class="plate-column right-plates" id="right-plates"></div>
                    </div>
                </div>
                <div class="sets-display" id="sets-label">No sets yet</div>
            </div>
            <div class="controls">
                <select id="exercise-select">
                    <option value="squat">Squat</option>
                    <option value="bench">Bench Press</option>
                    <option value="incline_bench">Incline Bench Press (SM)</option>
                    <option value="deadlift">Deadlift</option>
                    <option value="ohp">Overhead Press</option>
                    <option value="rows">Barbell Rows</option>
                </select>
                <div class="button-row">
                    <button id="set-button">üí™ Save Set</button>
                    <button id="reset-weight-button">üîÑ Reset Weight</button>
                </div>
                <div class="button-row">
                    <button id="delete-last-button">‚ùå Delete Last Set</button>
                </div>
                <div class="timer" id="rest-timer">Rest: 0:00</div>
                <div class="plate-buttons">
                    <button class="plate-button" data-weight="5">5 kg</button>
                    <button class="plate-button" data-weight="10">10 kg</button>
                    <button class="plate-button" data-weight="15">15 kg</button>
                    <button class="plate-button" data-weight="20">20 kg</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App state
        const state = {
            totalWeight: 20,
            currentExercise: "squat",
            sets: JSON.parse(localStorage.getItem('gym-sets')) || [],
            restTimer: null,
            restSeconds: 0,
            currentPlates: []
        };

        // DOM elements
        const elements = {
            screens: {
                home: document.getElementById('home-screen'),
                barbell: document.getElementById('barbell-screen')
            },
            buttons: {
                home: document.querySelectorAll('.home-button'),
                barbell: document.getElementById('barbell-button'),
                dumbbell: document.getElementById('dumbbell-button')
            },
            totalWeight: document.getElementById('total-weight-label'),
            setsLabel: document.getElementById('sets-label'),
            leftPlates: document.getElementById('left-plates'),
            rightPlates: document.getElementById('right-plates'),
            setButton: document.getElementById('set-button'),
            resetButton: document.getElementById('reset-weight-button'),
            deleteButton: document.getElementById('delete-last-button'),
            plateButtons: document.querySelectorAll('.plate-button'),
            exerciseSelect: document.getElementById('exercise-select'),
            timerDisplay: document.getElementById('rest-timer')
        };

        // Initialize
        updateTotalWeight();
        updateSetsLabel();
        startRestTimer();

        // Navigation functions
        function showScreen(screenName) {
            Object.values(elements.screens).forEach(screen => {
                screen.classList.remove('active');
            });
            elements.screens[screenName].classList.add('active');
        }

        // Core functions
        function addPlate(weight) {
            state.currentPlates.push(weight);
            renderPlates();
            state.totalWeight += weight * 2;
            updateTotalWeight();
        }

        function renderPlates() {
            elements.leftPlates.innerHTML = '';
            elements.rightPlates.innerHTML = '';
            
            state.currentPlates.forEach(weight => {
                const plate = document.createElement('div');
                plate.className = 'plate';
                plate.textContent = `${weight} kg`;
                plate.dataset.weight = weight;
                elements.leftPlates.appendChild(plate.cloneNode(true));
                elements.rightPlates.appendChild(plate);
            });
        }

        function resetWeight() {
            state.currentPlates = [];
            state.totalWeight = 20;
            renderPlates();
            updateTotalWeight();
        }

        function saveSet() {
            const reps = prompt("How many reps?", "5");
            if (reps === null) return;

            state.sets.push({
                exercise: state.currentExercise,
                weight: state.totalWeight,
                reps: parseInt(reps) || 0,
                date: new Date().toISOString()
            });
            
            localStorage.setItem('gym-sets', JSON.stringify(state.sets));
            updateSetsLabel();
            resetRestTimer();
        }

        function deleteLastSet() {
            if (state.sets.length > 0) {
                state.sets.pop();
                localStorage.setItem('gym-sets', JSON.stringify(state.sets));
                updateSetsLabel();
            }
        }

        function updateTotalWeight() {
            elements.totalWeight.textContent = `Total: ${state.totalWeight} kg`;
        }

        function updateSetsLabel() {
            const exerciseSets = state.sets
                .filter(set => set.exercise === state.currentExercise)
                .slice(-3);
            
            elements.setsLabel.textContent = exerciseSets.length > 0
                ? `${state.currentExercise.toUpperCase().replace('_', ' ')}:\n${exerciseSets.map(set => 
                    `${set.weight}kg √ó ${set.reps}`).join('\n')}`
                : "No sets yet";
        }

        function startRestTimer() {
            state.restTimer = setInterval(() => {
                state.restSeconds++;
                const mins = Math.floor(state.restSeconds / 60);
                const secs = state.restSeconds % 60;
                elements.timerDisplay.textContent = `Rest: ${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }, 1000);
        }

        function resetRestTimer() {
            state.restSeconds = 0;
            elements.timerDisplay.textContent = "Rest: 0:00";
        }

        // Event listeners
        elements.buttons.home.forEach(btn => {
            btn.addEventListener('click', () => showScreen('home'));
        });
        
        elements.buttons.barbell.addEventListener('click', () => showScreen('barbell'));
        elements.buttons.dumbbell.addEventListener('click', () => alert('Dumbbell tracker coming soon!'));

        elements.plateButtons.forEach(btn => {
            btn.addEventListener('click', () => addPlate(parseFloat(btn.dataset.weight)));
        });

        elements.setButton.addEventListener('click', saveSet);
        elements.resetButton.addEventListener('click', resetWeight);
        elements.deleteButton.addEventListener('click', deleteLastSet);
        
        elements.exerciseSelect.addEventListener('change', (e) => {
            if (state.currentExercise !== e.target.value) resetWeight();
            state.currentExercise = e.target.value;
            updateSetsLabel();
        });

        // Handle iPhone home bar
        document.documentElement.style.setProperty('--safe-area-inset-bottom', 'env(safe-area-inset-bottom)');
    </script>
</body>
</html>
